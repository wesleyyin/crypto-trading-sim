{"ast":null,"code":"var _jsxFileName = \"/Users/work/Documents/GitHub/referall-project/frontend/src/components/dashboard.component.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport Chart from 'kaktana-react-lightweight-charts';\nimport './dashboard.css';\nimport TransactionStub from './transaction-stub.component';\nimport axios from 'axios'; //pass in viewed user, connection status, and id of user who is viewing\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Dashboard extends Component {\n  constructor(props) {\n    super(props);\n    this.bcws = new WebSocket(\"wss://stream.binance.us:9443/ws/btcusdt@trade\");\n    this.updatePosts = this.updatePosts.bind(this);\n    this.renderPosts = this.renderPosts.bind(this);\n    this.bcOnMessage = this.bcOnMessage.bind(this);\n    this.renderNW = this.renderNW.bind(this);\n    this.handleTypeChange = this.handleTypeChange.bind(this);\n    this.handleCryptoNameChange = this.handleCryptoNameChange.bind(this);\n    this.onChangeQuantity = this.onChangeQuantity.bind(this);\n    this.submit = this.submit.bind(this);\n    this.renderForm = this.renderForm.bind(this);\n    this.state = {\n      posts: [],\n      bcLineSeries: [{\n        data: []\n      }],\n      bcData: [],\n      bcPrice: 0,\n      bcKey: 0,\n      type: \"BUY\",\n      cryptoName: \"Bitcoin\",\n      quantity: 0\n    };\n  }\n\n  componentDidMount() {\n    const user = localStorage.getItem(\"userID\");\n    alert(user);\n\n    if (user.length == 0) {\n      alert(\"you are not logged in\");\n      window.location.href = '/login';\n    }\n\n    this.bcws.onmessage = e => this.bcOnMessage(e);\n\n    this.updatePosts();\n  }\n\n  bcOnMessage(event) {\n    var response = JSON.parse(event.data);\n    var utcMiliSec = response.E;\n    var d = new Date(0);\n    d.setUTCMilliseconds(utcMiliSec);\n    var temp = {\n      time: utcMiliSec,\n      value: response.p\n    };\n    var data = this.state.bcData;\n    console.log(data);\n    var lineSeries = this.state.bcLineSeries;\n    console.log(lineSeries);\n    data.push(temp);\n    var pastKey = this.state.bcKey;\n    lineSeries[0].data = data;\n    this.setState({\n      bcData: data,\n      bcPrice: Number(response.p),\n      bcLineSeries: lineSeries,\n      bcKey: pastKey + 1\n    });\n  }\n\n  updatePosts() {\n    const user = localStorage.getItem(\"userID\");\n    axios.post(\"http://localhost:5000/posts/byuser\", {\n      user: user\n    }).then(function (res) {\n      console.log(res);\n      this.setState({\n        posts: res.data\n      });\n      console.log(this.state.posts);\n    }.bind(this)).catch(err => console.log('Error: ' + err));\n  }\n\n  renderPosts() {\n    if (this.state.bcPrice == 0) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 14\n      }, this);\n    }\n\n    const posts = this.state.posts;\n\n    if (typeof posts === \"undefined\" || posts.length == 0) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"You have no transaction history\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 16\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: posts.map(post => /*#__PURE__*/_jsxDEV(TransactionStub, {\n        post: post,\n        bcPrice: this.state.bcPrice\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }, this);\n  }\n\n  renderNW() {\n    if (this.state.bcPrice == 0) {\n      return /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"connecting...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 15\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: [\"Current Balance($100,000 starting): $\", this.getCashVal().toFixed(2) + this.getBCVal().toFixed(2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        children: [\"Cash: $\", this.getCashVal().toFixed(2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        children: [\"Bitcoin: $\", this.getBCVal().toFixed(2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 12\n    }, this);\n  }\n\n  getCashVal() {\n    let val = 100000;\n    const posts = this.state.posts;\n\n    if (typeof posts === \"undefined\" || posts.length == 0) {\n      return val;\n    }\n\n    for (let i = 0; i < posts.length; i++) {\n      const post = posts[i];\n\n      if (post.action == \"BUY\") {\n        val -= Number(post.quantity);\n      } else {\n        val += Number(post.quantity);\n      }\n    }\n\n    return val;\n  }\n\n  getBCVal() {\n    let val = 0;\n    const posts = this.state.posts;\n\n    if (typeof posts === \"undefined\" || posts.length == 0) {\n      return val;\n    }\n\n    let bitcoins = 0;\n\n    for (let i = 0; i < posts.length; i++) {\n      const post = posts[i];\n\n      if (post.cryptoName == \"Bitcoin\") {\n        if (post.action == \"BUY\") {\n          bitcoins += Number(post.quantity) / Number(post.price);\n        } else {\n          bitcoins -= Number(post.quantity) / Number(post.price);\n        }\n      }\n    }\n\n    val = bitcoins * this.state.bcPrice;\n    return val;\n  } //make more getters with more cryptos\n\n\n  handleTypeChange(e) {\n    this.setState({\n      type: e.target.value\n    });\n  }\n\n  handleCryptoNameChange(e) {\n    this.setState({\n      cryptoName: e.target.value\n    });\n  }\n\n  onChangeQuantity(e) {\n    this.setState({\n      quantity: e.target.value\n    });\n  }\n\n  submit() {\n    const quantity = this.state.quantity;\n    let price = 0;\n    const cash = this.getCashVal();\n    const bc = this.getBCVal();\n    const name = this.state.cryptoName;\n\n    if (this.state.type == \"BUY\" && quantity > cash) {\n      alert(\"Insufficient Funds\");\n      return;\n    }\n\n    if (this.state.type == \"SELL\") {\n      if (name == \"Bitcoin\") {\n        price = this.state.bcPrice;\n\n        if (price == 0) {\n          alert(\"Still connecting\");\n          return;\n        }\n\n        if (quantity > bc) {\n          alert(\"Insufficient Funds\");\n          return;\n        }\n      }\n    }\n\n    if (name == \"Bitcoin\") {\n      price = this.state.bcPrice;\n\n      if (price == 0) {\n        alert(\"Still connecting\");\n        return;\n      }\n    }\n\n    const postData = {\n      user: localStorage.getItem(\"userID\"),\n      name: name,\n      action: this.state.type,\n      quantity: quantity,\n      price: price\n    };\n    axios.post(\"http://localhost:5000/posts/add\", postData).then(function (res) {\n      console.log(res);\n      alert(res.data);\n      this.updatePosts();\n    }.bind(this)).catch(err => console.log('Error: ' + err));\n  }\n\n  renderForm() {\n    if (this.state.bcPrice != 0) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          children: \"Make a transaction\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          id: \"transtype\",\n          value: this.state.type,\n          onChange: this.handleTypeChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"BUY\",\n            children: \"BUY\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"SELL\",\n            children: \"SELL\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"$\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"number\",\n            id: \"quantity\",\n            required: true,\n            className: \"form-control\",\n            value: this.state.quantity,\n            onChange: this.onChangeQuantity\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 19\n          }, this), \"worth of:\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          id: \"selectedCrypto\",\n          value: this.state.cryptoName,\n          onChange: this.handleCryptoNameChange,\n          children: /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"Bitcoin\",\n            children: \"Bitcoin\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.submit,\n          children: \"Submit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 14\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }, this);\n  }\n\n  render() {\n    console.log(\"render\");\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"postDisplay\",\n      children: [/*#__PURE__*/_jsxDEV(Chart, {\n        lineSeries: this.state.bcLineSeries,\n        autoWidth: true,\n        height: 320\n      }, this.state.bcKey, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(this.renderNW, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(this.renderForm, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(this.renderPosts, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default Dashboard;","map":{"version":3,"sources":["/Users/work/Documents/GitHub/referall-project/frontend/src/components/dashboard.component.js"],"names":["React","Component","Link","Chart","TransactionStub","axios","Dashboard","constructor","props","bcws","WebSocket","updatePosts","bind","renderPosts","bcOnMessage","renderNW","handleTypeChange","handleCryptoNameChange","onChangeQuantity","submit","renderForm","state","posts","bcLineSeries","data","bcData","bcPrice","bcKey","type","cryptoName","quantity","componentDidMount","user","localStorage","getItem","alert","length","window","location","href","onmessage","e","event","response","JSON","parse","utcMiliSec","E","d","Date","setUTCMilliseconds","temp","time","value","p","console","log","lineSeries","push","pastKey","setState","Number","post","then","res","catch","err","map","getCashVal","toFixed","getBCVal","val","i","action","bitcoins","price","target","cash","bc","name","postData","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {Link} from 'react-router-dom';\nimport Chart from 'kaktana-react-lightweight-charts'\nimport './dashboard.css';\nimport TransactionStub from './transaction-stub.component'\n\nimport axios from 'axios'\n//pass in viewed user, connection status, and id of user who is viewing\n\nclass Dashboard extends Component {\n  bcws = new WebSocket (\"wss://stream.binance.us:9443/ws/btcusdt@trade\");\n  constructor(props){\n    super(props);\n    \n    this.updatePosts= this.updatePosts.bind(this);\n    this.renderPosts = this.renderPosts.bind(this);\n    this.bcOnMessage = this.bcOnMessage.bind(this);\n    this.renderNW = this.renderNW.bind(this);\n    this.handleTypeChange = this.handleTypeChange.bind(this);\n    this.handleCryptoNameChange = this.handleCryptoNameChange.bind(this);\n    this.onChangeQuantity = this.onChangeQuantity.bind(this);\n    this.submit = this.submit.bind(this);\n    this.renderForm = this.renderForm.bind(this);\n    this.state = {\n      posts : [],\n      bcLineSeries : [{\n          data: [\n              \n          ]\n      }],\n      bcData: [],\n      bcPrice: 0,\n      bcKey: 0,\n      type: \"BUY\",\n      cryptoName: \"Bitcoin\",\n      quantity: 0\n      \n\n    };\n    \n  }\n  \n  componentDidMount(){\n    const user = localStorage.getItem(\"userID\");\n    alert(user);\n    if (user.length ==0) {\n        alert(\"you are not logged in\");\n        window.location.href = '/login';\n    }this.bcws.onmessage = (e)=> this.bcOnMessage(e);\n    this.updatePosts();\n}\n  \nbcOnMessage(event){\n    var response = JSON.parse(event.data)\n    var utcMiliSec = response.E\n    var d = new Date(0)\n    d.setUTCMilliseconds(utcMiliSec)\n    var temp = {time: utcMiliSec, value: response.p}\n    var data = this.state.bcData;\n    console.log(data);\n    var lineSeries = this.state.bcLineSeries;\n    console.log(lineSeries);\n    data.push(temp);\n    var pastKey = this.state.bcKey;\n    lineSeries[0].data = data\n    this.setState({\n        bcData: data,\n        bcPrice: Number(response.p),\n        bcLineSeries: lineSeries,\n        bcKey: pastKey+1\n    })\n    \n}\nupdatePosts(){\n    const user = localStorage.getItem(\"userID\");\n  \n  \n   axios.post(\"http://localhost:5000/posts/byuser\", {user: user})\n       .then(function(res){\n         console.log(res);\n           this.setState({\n               posts: res.data\n           });\n           console.log(this.state.posts);\n           \n       }.bind(this)) \n       .catch(err => console.log('Error: ' + err));\n}\n\n  renderPosts(){\n    if(this.state.bcPrice==0){\n      return(<div></div>);\n    }\n      const posts = this.state.posts;\n    if(typeof posts === \"undefined\"||posts.length==0){\n        return(<p>You have no transaction history</p>);\n    }return(<div>\n        {posts.map((post) =>\n            <TransactionStub post = {post} bcPrice={this.state.bcPrice}/>\n        )}\n    </div>)\n  }\n  renderNW(){\n    if(this.state.bcPrice==0){\n      return (<h3>connecting...</h3>)\n    }\n    return(<div>\n      <h4>Current Balance($100,000 starting): ${this.getCashVal().toFixed(2) + this.getBCVal().toFixed(2)}</h4>\n      <h5>Cash: ${this.getCashVal().toFixed(2)}</h5>\n      <h5>Bitcoin: ${this.getBCVal().toFixed(2)}</h5>\n      </div>)\n  }\n  getCashVal(){\n    let val = 100000;\n    const posts = this.state.posts;\n    if(typeof posts === \"undefined\"||posts.length==0){\n        return val;\n    }\n    for(let i = 0; i < posts.length; i++){\n        const post = posts[i];\n        if(post.action == \"BUY\"){\n            val -= Number(post.quantity);\n        }else{\n            val += Number(post.quantity);\n        }\n    }\n    return val;\n  }\n  getBCVal(){\n    let val = 0;\n    const posts = this.state.posts;\n    if(typeof posts === \"undefined\"||posts.length==0){\n        return val;\n    }\n    let bitcoins= 0;\n    for(let i = 0; i < posts.length; i++){\n        const post = posts[i];\n        if(post.cryptoName == \"Bitcoin\"){\n          if(post.action == \"BUY\"){\n            bitcoins += Number(post.quantity)/Number(post.price);\n          }else{\n            bitcoins -= Number(post.quantity)/Number(post.price);\n          }\n        }\n        \n    }val = bitcoins * this.state.bcPrice;\n    return val;\n  }//make more getters with more cryptos\n  handleTypeChange(e){\n    this.setState({\n      type: e.target.value\n    })\n  }\n  handleCryptoNameChange(e){\n    this.setState({\n      cryptoName: e.target.value\n    })\n  }\n  onChangeQuantity(e){\n    this.setState({\n      quantity: e.target.value\n    })\n  }\n  submit(){\n    const quantity = this.state.quantity;\n    let price = 0;\n    const cash = this.getCashVal();\n    const bc = this.getBCVal();\n    const name = this.state.cryptoName;\n\n    if(this.state.type == \"BUY\" && quantity> cash){\n      alert(\"Insufficient Funds\");\n      return;\n    }if(this.state.type == \"SELL\"){\n      if(name == \"Bitcoin\"){\n        price = this.state.bcPrice;\n        if(price==0){\n          alert(\"Still connecting\");\n          return;\n        }\n        if(quantity > bc){\n          alert(\"Insufficient Funds\");\n        return;\n        }\n      }\n    }\n    if(name == \"Bitcoin\"){\n      price = this.state.bcPrice;\n      if(price==0){\n        alert(\"Still connecting\");\n        return;\n      }\n    }\n    const postData = {\n      user: localStorage.getItem(\"userID\"),\n      name: name,\n      action: this.state.type,\n      quantity: quantity,\n      price: price\n    }\n    axios.post(\"http://localhost:5000/posts/add\",postData)\n       .then(function(res){\n         console.log(res);\n           alert(res.data);\n           this.updatePosts();\n           \n       }.bind(this)) \n       .catch(err => console.log('Error: ' + err));\n\n\n  }\n  renderForm(){\n    if(this.state.bcPrice !=0){\n      return(<div>\n                <h5>Make a transaction</h5>\n                <select id = \"transtype\" value={this.state.type} onChange={this.handleTypeChange}>\n                        <option value=\"BUY\">BUY</option>\n                        <option value=\"SELL\">SELL</option>\n                  </select>\n                  <p>$\n                  <input type=\"number\" id=\"quantity\" \n                        required \n                        className = \"form-control\" \n                        value = {this.state.quantity}\n                        onChange = {this.onChangeQuantity}/>\n                \n                worth of:</p>\n                <select id = \"selectedCrypto\" value={this.state.cryptoName} onChange={this.handleCryptoNameChange}>\n                        <option value=\"Bitcoin\">Bitcoin</option>\n                  </select>\n                \n                <button onClick = {this.submit}>Submit</button>\n      </div>);\n    }return(<div></div>);\n  }\n  render() {\n    console.log(\"render\");\n    \n    return (\n      <div id = \"postDisplay\">\n          <Chart lineSeries={this.state.bcLineSeries} key = {this.state.bcKey}autoWidth height={320} />\n            <this.renderNW/>\n            <this.renderForm/>\n            <this.renderPosts/>\n            \n       \n      </div>\n    );\n  }\n}\n \nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}